!function(b,A,c,e){"use strict";b.fn.exopiteMultifilter=function(n){var a={loadingFinishedText:"No More Posts Available"},l=function(e,i,t,o,n){switch(i){case"out":e.stop(!0,!1).slideUp(500).css({opacity:0,transition:"opacity .5s"});break;case"in":e.stop(!0,!1).css({opacity:1,transition:"opacity .5s",height:"auto"}).slideDown(500).promise().then(function(){t&&void 0!==wp.hooks&&wp.hooks.doAction("ema-success-animation-end",o,n)})}},_=b.proxy(function(){return this.selector},this);return this.each(function(m,e){var g,v=e,x=(b.extend({},a,n),{filterItems:b(v).find(".exopite-multifilter-filter-item"),nowLoading:b(v).find(".exopite-multifilter-now-loading"),taxonomies:b(v).find(".exopite-multifilter-filter-taxonomy"),searchButton:b(v).find(".exopite-multifilter-filter-reset-search").find('button[type="submit"]'),searchField:b(v).find(".exopite-multifilter-filter-reset-search").find("form").find("input"),reset:b(v).find(".exopite-multifilter-filter-reset"),itemsContainer:b(v).find(".exopite-multifilter-items"),pagination:b(v).find(".exopite-multifilter-paginations"),loading:b(v).find(".exopite-multifilter-now-loading")}),s=!1,r=!1,w=1,k="",i=function(e,i){if(v===e&&"pagination"==i.pagination){var t=b(e).offset().top;if(!(0<t-b(A).scrollTop()))return b("#wpadminbar").length&&(t-=b("#wpadminbar").height()),t-=b("header nav").height(),b("html, body").animate({scrollTop:t},300),e}},y=function(){if(g.display_filter){g.include_taxonomies=(n={},x.taxonomies.each(function(e,i){var t=b(i).data("taxonomy");n[t]={};var o=[];b(i).find(".active").each(function(e,i){o.push(b(i).data("term"))}),n[t]=o}),n)}var n;x.searchField.length&&(g.search=k),g.paged=w,g.store_session&&localStorage.setItem(_()+m,JSON.stringify({include_taxonomies:g.include_taxonomies,paged:w,search:k})),b.ajax({cache:!1,type:"POST",url:wp_ajax.ajax_url,data:{action:"exopite_multifilter_get_posts",json:JSON.stringify(g)},beforeSend:function(){s=!0,void 0!==wp.hooks&&wp.hooks.doAction("ema-before-send",v,g),"pagination"!=g.pagination&&1!=w||l(x.itemsContainer,"out",!1,null,null),"infinite"!=g.pagination&&l(x.pagination,"out",!1,null,null),l(x.loading,"in",!1,null,null)},success:function(e){void 0!==wp.hooks&&wp.hooks.doAction("ema-success-top",v,g),l(x.loading,"out",!1,null,null);var i=b(e),t=i.find("article"),o=i.filter(".no-posts-found");if(0<t.length){var n=i.filter(".exopite-multifilter-paginations").children(":first"),a=x.itemsContainer.data("page")+"page/"+w+"/";if("pagination"==g.pagination||1==w)x.itemsContainer.html(t),"masonry"==g.style?b(x.itemsContainer).css({opacity:1,height:"auto",display:"flex"}):l(x.itemsContainer,"in"),void 0!==wp.hooks&&wp.hooks.doAction("ema-success-items-paginated",v,t),b(v).trigger("success-items-paginated.exopiteMultifilter",[v,t]);else{if(g.display_page_number)t=b('<div class="page-number" data-page="'+a+'">'+w+"</div>").add(t);else g.update_paged&&t.filter("article").first().attr("data-page",a);x.itemsContainer.append(t),void 0!==wp.hooks&&wp.hooks.doAction("ema-success-items-appended",v,t),b(v).trigger("success-items-appended.exopiteMultifilter",[v,t])}void 0!==wp.hooks&&wp.hooks.doAction("ema-success",v,t),b(v).trigger("success-ajax.exopiteMultifilter",[v,t]),g.update_paged&&a!=A.location&&Exopite.changeBrowserUrl(a),"infinite"!=g.pagination&&(x.pagination.html(n),l(x.pagination,"in",!0,v,g))}else"pagination"!=g.pagination&&1!=w||x.itemsContainer.empty(),x.pagination.html(o),l(x.itemsContainer,"in",!1,null,null),l(x.pagination,"in",!1,null,null),r=!0,setTimeout(function(){x.pagination.fadeOut("fast")},3e3);b(v).find(".nothing-more").length&&setTimeout(function(){x.pagination.fadeOut("fast")},3e3),void 0!==wp.hooks&&wp.hooks.doAction("ema-success-end",v,g),s=!1},error:function(e,i,t){void 0!==wp.hooks&&wp.hooks.doAction("ema-error",v),console.log("Error: "+e.responseText),console.log("Error: "+e),console.log("Error: "+i),console.log("Error: "+t),s=!1}})},t=Exopite.throttle(function(){void 0!==g&&("infinite"==g.pagination&&!s&&!r&&"infinite"==g.pagination&&b(A).scrollTop()>=b(x.itemsContainer).children().last().offset().top+b(x.itemsContainer).children().last().outerHeight()-A.innerHeight&&(w++,void 0!==wp.hooks&&wp.hooks.doAction("ema-bottom-reached",v),y()),g.update_paged&&b("[data-page]").each(function(e,i){var t=b(i).data("page");if(isElementInViewport(i)){if(A.location.href==t)return;Exopite.changeBrowserUrl(t)}}))},100);b(c).on("scroll",t);var o=function(e){switch(r=!1,w=1,k="","search"!=e&&x.searchField.val(""),e){case"search":k=x.searchField.val();case"reset":x.filterItems.removeClass("active")}};x.searchButton.on("click",function(e){e.preventDefault(),s||""!==x.searchField.val()&&(o("search"),void 0!==wp.hooks&&wp.hooks.doAction("ema-search",v,x.searchField.val()),y())}),x.reset.on("click",function(e){e.preventDefault(),s||(o("reset"),void 0!==wp.hooks&&wp.hooks.doAction("ema-reset",v),y())}),x.filterItems.on("click",function(e){if(e.preventDefault(),!s){if(void 0!==wp.hooks&&wp.hooks.doAction("ema-filter-selected",v),!0===g.multi_selectable)o(),b(this).toggleClass("active");else{var i=b(this).hasClass("active");o("reset"),i||b(this).addClass("active")}y()}}),x.pagination.on("click",".page-numbers, .btn-readmore",function(e){var i,t,o;(e.preventDefault(),s)||(i=b(this),t=i.attr("href"),o=/pages?\/(\d+)/g.exec(t),w=o?o[1]:1,void 0!==wp.hooks&&wp.hooks.doAction("ema-pagination",v),y())}),g=b(v).data("ajax"),b(v).attr("data-index",m),void 0!==wp.hooks&&wp.hooks.addAction("ema-before-send",i,10);void 0!==g&&(g.store_session||g.load_from_url)&&function(){var e,i,t,o,n,a,s=null,r=!1,l=!0;if(g.load_from_url){var c=(a={},A.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,i,t){a[i]=t}),a).multifilter;if(c&&"null"!==c&&"undefined"!==c){var d=b(v).attr("id");if(d&&"null"!==d&&"undefined"!==d){var p=JSON.parse(decodeURI(c)),f=p[d];if(f&&"null"!==f&&"undefined"!==f){l=!1,s=f,delete p[d];var u=JSON.stringify(p),h=(e=A.location.href,i="multifilter",t=u,o=new RegExp("(\\?|\\&)("+i+"=).*?(&|$)"),n=0<=(n=e).search(o)?e.replace(o,"$1$2"+t+"$3"):n+(0<n.indexOf("?")?"&":"?")+i+"="+t);"?"==(h=h.replace(/multifilter={}(\&?)/i,"")).charAt(h.length-1)&&(h=h.substr(0,h.length-1)),A.history.replaceState(null,null,h)}}}}g.store_session&&l&&(s=JSON.parse(localStorage.getItem(_()+m))),s&&"null"!==s&&"undefined"!==s&&("pagination"==g.pagination&&(w=s.paged),""!==s.search&&"undefined"!==s.search&&void 0!==s.search?(k=s.search,x.searchField.val(k),r=!0):x.taxonomies.each(function(e,i){var t=Object.keys(s.include_taxonomies)[e];if(b(i).data("taxonomy")==t){if(s.include_taxonomies[t].length<1)return!0;b(i).find(".exopite-multifilter-filter-item").each(function(e,i){-1!==b.inArray(b(i).data("term"),s.include_taxonomies[t])&&(b(i).addClass("active"),r=!0)})}}),void 0!==wp.hooks&&wp.hooks.doAction("ema-load-session",v),(1<w||r)&&y())}()})},b(function(){b(".exopite-multifilter-container").not("ajax-disabled").exopiteMultifilter()})}(jQuery,window,document);
